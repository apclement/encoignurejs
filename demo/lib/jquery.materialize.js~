(function($){

var effects = {
	all: ['translate-l', 'translate-r', 'flip', 'flip-r', 'fade'],
	'translate-l': {reverse: 'translate-r'},
	'translate-r': {reverse: 'translate-l'},
}

var effectClass = effects.all.join(' ')
var events = ' webkitTransitionEnd'

var current = 'fade'

var transitionEndHandler = function(e){		
	//alert('end');$(this).removeClass(effectClass).css('visibility', 'hidden').unbind(events)
}

$.fn.switchTo = function(effect) {
	effect = effect || current
	var $view = $(this)
	
	if ($view.css('visibility') == 'visible' || !$view.hasClass('out'))
		return
	
	//alert(Modernizr.prefixed('transform')+'End')
	
	$view.parent().children('.view:not(.out)').bind(events, transitionEndHandler).css('visibility', 'visible').removeClass(effectClass + ' in').addClass(effect+' out')
	$view.css('visibility', 'visible').removeClass(effectClass + ' out').addClass(effect+' in')
}

$.fn.materialize = function(url, event, args){
	var $section = $(this)
	var name = $(this).attr('id')
	
	if ($section.children().length == 0){
		$.get(url, function(data){		
			$('<div>').html(data).children().children().appendTo($section)				
						
			$.ajax({
				crossDomain: true,
				dataType: "script",
				url: url.replace('.html', '.js'),
				success: function(){
					$section.trigger(event, [args])
				}
			})
		});	
	} else {
		$section.trigger(event, [args])
	}
	
	$('#'+ $section.attr('id')).switchTo()	  
}

$(document).ready(function(){
	$(document).on('click', 'a[data-transition]', function(){
		current = $(this).attr('data-transition') || 'fade'
	})
		
})

})(jQuery);  
